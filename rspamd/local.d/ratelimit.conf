# Rate limiting to prevent SMTP abuse (requires Redis)
rates {
  # Limit per sender IP address
  to = {
    selector = "ip";
    bucket {
      burst = 30;
      rate = "20 / 1min";
    }
  }

  # Limit per sender address
  from = {
    selector = "from";
    bucket {
      burst = 50;
      rate = "30 / 1min";
    }
  }

  # Limit per recipient (prevents address harvesting)
  to_ip = {
    selector = "to";
    bucket {
      burst = 20;
      rate = "10 / 1min";
    }
  }

  # Limit bounces (prevents backscatter attacks)
  bounce_to = {
    selector = "bounce_to";
    bucket {
      burst = 5;
      rate = "2 / 1min";
    }
  }
}

whitelisted_rcpts = "postmaster,mailer-daemon";
